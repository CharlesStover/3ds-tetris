var e=null;
window.tetris={b:21,e:[{color:"#65c4e9",d:[[[1],[1],[1],[1]],[[1,1,1,1]]]},{color:"#65a2d7",d:[[[1,1],[1,0],[1,0]],[[1,1,1],[0,0,1]],[[0,1],[0,1],[1,1]],[[1,0,0],[1,1,1]]]},{color:"#ffae65",d:[[[1,0],[1,0],[1,1]],[[1,1,1],[1,0,0]],[[1,1],[0,1],[0,1]],[[0,0,1],[1,1,1]]]},{color:"#fee065",d:[[[1,1],[1,1]]]},{color:"#a4d87d",d:[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]]},{color:"#be80c0",d:[[[1,1,1],[0,1,0]],[[0,1],[1,1],[0,1]],[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]]]},{color:"#f47e87",d:[[[1,1,0],[0,1,1]],
[[0,1],[1,1],[1,0]]]}],h:[],canvas:e,clear:function(){for(var a=0;a<this.e[this.a.b].d[this.a.rotation].length;a++)if(this.a.position.y+a>=0)for(var b=0;b<this.e[this.a.b].d[this.a.rotation][0].length;b++)this.e[this.a.b].d[this.a.rotation][a][b]==1&&this.c.clearRect((this.a.position.x+b)*this.b+1,(this.a.position.y+a)*this.b+1,this.b-1,this.b-1)},o:function(){this.c.lineWidth=2;this.c.strokeStyle="rgb(192, 192, 192)";this.c.beginPath();for(var a=0;a<=this.width;a++)this.c.moveTo(a*this.b+1,1),this.c.lineTo(a*
this.b+1,this.height*this.b+1);for(var b=0;b<=this.height;b++)this.h.push([]),this.c.moveTo(1,b*this.b+1),this.c.lineTo(this.width*this.b+1,b*this.b+1);this.c.stroke();this.c.closePath();for(a=0;a<this.width;a++)for(b=0;b<this.height;b++)this.h[b].push(0),this.c.clearRect(a*this.b+1,b*this.b+1,this.b-1,this.b-1);this.a.next.canvas.setAttribute("height",4*this.b/2+1);this.a.next.canvas.setAttribute("width",4*this.b/2+1);this.a.next.c=this.a.next.canvas.getContext("2d");this.a.next.c.lineWidth=2;this.a.next.c.strokeStyle=
"rgb(192, 192, 192)";this.a.next.c.beginPath();for(a=0;a<=4;a++)this.a.next.c.moveTo(a*this.b/2+1,1),this.a.next.c.lineTo(a*this.b/2+1,4*this.b/2+1);for(b=0;b<=4;b++)this.a.next.c.moveTo(1,b*this.b/2+1),this.a.next.c.lineTo(4*this.b/2+1,b*this.b/2+1);this.a.next.c.stroke();this.a.next.c.closePath();for(a=0;a<4;a++)for(b=0;b<4;b++)this.a.next.c.clearRect(a*this.b/2+1,b*this.b/2+1,this.b/2-1,this.b/2-1)},c:e,j:{r:function(a){var b=document.cookie.split(";");a+="=";for(x=0;x<b.length;x++){var c=b[x].match(/^\s*(.*)$/)[1];
if(c.indexOf(a)==0)return c.substring(a.length,c.length)}return 0},set:function(a,b,c){typeof c=="undefined"&&(c=31536E6);var d=new Date;d.setTime(d.getTime()+c);document.cookie=a+"="+b+"; expires="+d.toGMTString()+"; path=/"}},create:function(){if(!this.pause)this.a.b=this.a.next.b,this.a.rotation=this.a.next.rotation,this.next(),this.a.position={x:Math.round((this.width-this.e[this.a.b].d[this.a.rotation][0].length)/2),y:-1*this.e[this.a.b].d[this.a.rotation].length}},display:function(a,b){this.c.fillStyle=
"#ffffff";this.c.font="bold 30px sans-serif";this.c.shadowBlur=5;this.c.shadowColor="rgba(0, 0, 0, 0.25)";this.c.shadowOffsetX=3;this.c.shadowOffsetY=3;this.c.strokeStyle="#000000";this.c.textAlign="center";this.c.textBaseline="middle";var c=this.width*this.b/2,d=this.height*this.b/2;this.c.fillText(a,c,d-100);this.c.strokeText(a,c,d-100);typeof b=="undefined"&&(this.c.fillText(a,c,d+100),this.c.strokeText(a,c,d+100));this.c.shadowBlur=0;this.c.shadowOffsetX=0;this.c.shadowOffsetY=0},k:!1,l:function(){if(!this.pause){this.c.fillStyle=
this.e[this.a.b].color;for(var a=0;a<this.e[this.a.b].d[this.a.rotation].length;a++)if(this.a.position.y+a>=0)for(var b=0;b<this.e[this.a.b].d[this.a.rotation][0].length;b++)this.e[this.a.b].d[this.a.rotation][a][b]==1&&this.c.fillRect((this.a.position.x+b)*this.b+1,(this.a.position.y+a)*this.b+1,this.b-1,this.b-1)}},t:function(a){if(!this.pause){this.pause=!0;this.q+=a.length;this.z([10,50,250,1250][a.length-1]);for(var b=a.length-1;b>=0;b--){for(var c=0;c<this.width;c++)for(var d=0;d<=5;d++)setTimeout('tetris.c.fillStyle = "rgb(255, '+
Math.floor(d*255/5)+", "+Math.floor(d*255/5)+')"; tetris.c.fillRect('+(c*this.b+1)+", "+(a[b]*this.b+1)+", "+(this.b-1)+", "+(this.b-1)+");",20*d+50*c);setTimeout("var img = tetris.c.getImageData(0, 0, "+this.width*this.b+", "+this.b*a[b]+"); tetris.c.putImageData(img, 0, "+this.b+"); for (var x = 0; x < "+this.width+"; x++) { tetris.c.clearRect(x * "+this.b+" + 1, 1, "+(this.b-1)+", "+(this.b-1)+"); } for (var y = "+a[b]+"; y >= 0; y--) { for (x = 0; x < "+this.width+"; x++){tetris.h[y][x] = (y == 0 ? 0 : tetris.h[y - 1][x]);}}"+
(b==0?" tetris.pause = false; tetris.create(); tetris.g();":""),Math.round((100+50*this.width)*(1+(a.length-b)/2)))}}},pause:!1,g:function(a){typeof a=="undefined"&&(a=!1);if(!tetris.pause)if(tetris.m(0,1))tetris.clear(),tetris.a.position.y++,tetris.l();else{a=!1;if(tetris.a.position.y<0){tetris.pause=!0;document.onkeydown=function(){return!1};var a=tetris.j.r("highscore"),b=parseInt(tetris.f.firstChild.nodeValue,10);b>a&&(tetris.j.set("highscore",b),tetris.i.removeChild(tetris.i.firstChild),tetris.i.appendChild(document.createTextNode(b.toString())));
tetris.display(b>a?"High Score":"Game Over");setTimeout("document.onkeydown = tetris.start;",1E3);return!1}for(b=0;b<tetris.e[tetris.a.b].d[tetris.a.rotation][0].length;b++)for(var c=0;c<tetris.e[tetris.a.b].d[tetris.a.rotation].length;c++)tetris.e[tetris.a.b].d[tetris.a.rotation][c][b]==1&&(tetris.h[tetris.a.position.y+c][tetris.a.position.x+b]=1);for(var d=[],c=tetris.height-1;c>=0;c--){for(var f=0,b=0;b<tetris.width;b++)if(tetris.h[c][b]==1)f++;else break;f==tetris.width&&d.push(c)}if(d.length>
0)return tetris.t(d),!1;tetris.create()}a?tetris.g(!0):tetris.n.g=setTimeout(tetris.g,Math.round(Math.max(20,tetris.A-tetris.q*10)/(tetris.k?4:1)))},u:function(){tetris.pause||(tetris.n.g!==e&&clearTimeout(tetris.n.g),tetris.g(!0))},p:!0,height:20,m:function(a,b){if(this.a.position.x+a<0||this.a.position.x+this.e[this.a.b].d[this.a.rotation][0].length+a>this.width||this.a.position.y+this.e[this.a.b].d[this.a.rotation].length+b>this.height)return!1;for(var c=0;c<this.e[this.a.b].d[this.a.rotation][0].length;c++)for(var d=
0;d<this.e[this.a.b].d[this.a.rotation].length;d++)if(this.a.position.y+d+b>=0&&this.e[this.a.b].d[this.a.rotation][d][c]==1&&this.h[this.a.position.y+d+b][this.a.position.x+c+a]==1)return!1;return!0},v:function(){location.href="#tetris";if(typeof event=="object"&&tetris.a.b!==e)if(event.keyCode==13||event.keyCode==32||event.keyCode==65)tetris.rotate(1);else if(event.keyCode==37||event.keyCode==39)tetris.move(event.keyCode-38);else if(event.keyCode==38)tetris.u();else if(event.keyCode==40)tetris.k=!0;else if(event.keyCode==
80)tetris.pause=!tetris.pause},w:function(){if(typeof event=="object"&&event.keyCode==40)tetris.k=!1},q:0,move:function(a){!this.pause&&this.m(a,0)&&(this.clear(),this.a.position.x+=a,this.l())},next:function(){if(this.a.next.b!==e)for(var a=0;a<this.e[this.a.next.b].d[this.a.next.rotation].length;a++)for(var b=0;b<this.e[this.a.next.b].d[this.a.next.rotation][0].length;b++)this.e[this.a.next.b].d[this.a.next.rotation][a][b]==1&&this.a.next.c.clearRect(b*this.b/2+1,a*this.b/2+1,this.b/2-1,this.b/
2-1);this.a.next.b=this.random(this.e.length-1);this.a.next.rotation=this.random(this.e[this.a.next.b].d.length-1);this.a.next.c.fillStyle=this.e[this.a.next.b].color;for(a=0;a<this.e[this.a.next.b].d[this.a.next.rotation].length;a++)for(b=0;b<this.e[this.a.next.b].d[this.a.next.rotation][0].length;b++)this.e[this.a.next.b].d[this.a.next.rotation][a][b]==1&&this.a.next.c.fillRect(b*this.b/2+1,a*this.b/2+1,this.b/2-1,this.b/2-1)},a:{b:e,next:{b:e,canvas:e,c:e,rotation:e},position:{x:e,y:e},rotation:e},
random:function(a,b){typeof b!="number"&&(b=a,a=0);b++;return Math.floor(Math.random()*(b-a))+a},rotate:function(a){if(!this.pause){var b=this.e[this.a.b].d,c=this.a.rotation;this.clear();for(this.a.rotation+=a;this.a.rotation<0;)this.a.rotation+=b.length;for(;this.a.rotation>=b.length;)this.a.rotation-=b.length;if(!this.m(0,0))this.a.rotation=c;this.l()}},z:function(a){a=parseInt(this.f.firstChild.nodeValue,10)+a;this.f.removeChild(this.f.firstChild);this.f.appendChild(document.createTextNode(a))},
f:e,A:400,start:function(){tetris.canvas=document.getElementById("tetris-canvas");if(typeof tetris.canvas.getContext=="function")tetris.h=[],tetris.pause=!1,tetris.i=document.getElementById("high-score"),tetris.i.removeChild(tetris.i.firstChild),tetris.i.appendChild(document.createTextNode(tetris.j.r("highscore"))),tetris.a.next.canvas=document.getElementById("tetris-next-canvas"),tetris.f=document.getElementById("score"),tetris.f.removeChild(tetris.f.firstChild),tetris.f.appendChild(document.createTextNode("0")),
tetris.canvas.setAttribute("height",tetris.height*tetris.b+1),tetris.canvas.setAttribute("width",tetris.width*tetris.b+1),tetris.c=tetris.canvas.getContext("2d"),tetris.o(),tetris.p?(tetris.p=!1,tetris.display("Insert Coin",!0),tetris.c.fillStyle="#000000",tetris.c.font="bold 12px sans-serif",tetris.c.textAlign="left",tetris.c.fillText("Controls:",28,242),tetris.c.font="normal 12px monospace",tetris.c.lineWidth=7,tetris.c.strokeStyle="#ffffff",tetris.c.strokeText("A:           rotate",33,263),tetris.c.strokeText("down:        speed up",
33,284),tetris.c.strokeText("left/right:  move",33,305),tetris.c.strokeText("up:          drop",33,326),tetris.c.fillText("A:           rotate",33,263),tetris.c.fillText("down:        speed up",33,284),tetris.c.fillText("left/right:  move",33,305),tetris.c.fillText("up:          drop",33,326),tetris.c.textAlign="center",tetris.c.strokeText("PRESS ANY KEY TO START",tetris.width*tetris.b/2,368),tetris.c.fillText("PRESS ANY KEY TO START",tetris.width*tetris.b/2,368),location.href="#tetris",document.onkeydown=
tetris.s):tetris.s()},s:function(){location.href="#tetris";tetris.o();tetris.next();tetris.create();tetris.g();document.onkeydown=tetris.v;document.onkeyup=tetris.w},n:{g:e},width:10};
